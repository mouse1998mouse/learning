# 交换机基本原理
> 具有MAC地址,而hub不存在mac地址

- 可以实现单播
- 隔离冲突域
- 防止交换成环，避免形成广播风暴

原理：
1. 交换机基于数据的源mac地址进行学习
2. 基于数据的目的mac地址根据地址表进行转发
3. 对于数据的目标mac地址没有学习过，也就是没有mac地址表项（默认保持300s），会执行泛洪。
4. 交换机的接口可以学习多个mac地址
5. 一个mac地址只能被一个交换机接口学习
6. 对于广播和组播的数据，交换机一律采取泛洪的措施。


# VLAN
划分局域网
防止泛洪域太大，广播域太大

### 概念
VLAN：虚拟局域网
同一个交换机的不同VLAN不能相互通信。不同交换机的相同VLAN可以相互通信。
交换机一定要划分VLAN，便于管理和隔离。

###### 主要是用于隔离广播域
###### ps：默认的是VLAN1，所有接口都属于VLAN1

### Trunk
**可以承载多个VLAN的数据**。交换机与交换机之间实现Trunk，相当于失去了VLAN。
在传输过程中，打上一个VLAN号的标记，表明是发送到何种VLAN的，然后再交付时，去除VLAN号标记。

交换机最多能支持4096个VLAN，范围0-4095，其中0和4095不能使用。Vlan1  vlan1003 1003 1004 1005是交换机初始就有的vlan，是不可以被删除的。
Vlan1能使用，其他四个vlan不能使用。保留1-1001作为标准vlan。
1006-4094 是扩展vlan。vtp协议的transparent模式可用。

两个接口间的本征VLAN（native VLAN）一定要匹配，防止VLAN错位。


# VTP协议（思科私有）
一个能够宣告VLAN配置信息的协议，通过一个共有的管理域，维持vlan配置信息的一致性。VTP只能在主干端口发送要宣告的信息。

###### 只能在trunk下使用

协议要素：
1. VTP域
2. VTP通告
3. VTP模式
4. VTP服务器：VLAN创建、删除、重命名、并产生通告。
5. VTP客户端：只能发送通告，只在工作时保存。
6. VLAN信息：必须经过手动配置才能成为客户端模式。
7. VTP透明：VLAN创建、删除、重命名、但不产生通告，只对本机有效。


client断电就没有，需要再重新匹配通告。service不会。

# STP协议（重点）
处理单点失效链路、成环等
STP：生成树协议。解决环路，冗余问题。

STP的操作：
1. 每个广播域选一个根桥
2. 每个非根桥选一个跟端口
3. 每个段选择一个指定端口
4. 阻塞非指定端口。


BPDU：桥数据单元。里面包含了：
1. bridge ID
2. 优先级（越小越优先）
3. mac地址（交换机主板网卡的地址）
4. root ID

### 根桥
根据优先级选出一个最优的作为root。一切设备向root看齐。root每2s向外发送一个BPDU。root还会在BPDU中发送root id，自身mac地址等等。
对比了根桥后，其他的机器就不发BPDU,由根桥进行泛洪。

根桥不能出现在底层的接入层。
##### 每个非根桥选择一个根端口，到达根桥最优。根端口选择：
1. 到根桥的最低路径成本
2. 最低的发送者网桥ID
3. 最低的发送者端口ID（越小越优先）

##### 每个段选择一个端口
在不存在跟端口的链路中，对比BPDU，根据brige ID进行对比。
根端口一般是收BPDU，而不是发BPDU。

端口状态
1. block：非指定端口。
2. **listen**：监听，不能学习mac地址，不能转发数据。维持15s。确认端口角色。
3. **learn**：学习mac地址，不能转发数据，维持15s。
4. **forward**：可以转发数据。
5. disable：禁用。

#### 异常情况，生成树工作。
感知到端口有问题，直连的话，立马就block，然后listen、learn、forward。

如果链路断了，就会在最近的交换机的根端口，开启阻塞，往上发送一个TCN（类似BPDU），找到根桥，再重新发送BPDU配置。